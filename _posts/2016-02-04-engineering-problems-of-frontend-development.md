---
title: 前端工程优化之路
date: 2016-02-04 16:35:36 +0800
categories:
  - web-development
tags:
  - frontend-web-development
  - software-engineering
  - frontend-engineering
  - maihaoche
---

在我加入「[买好车][mhc-url]{:target="_blank"}{:rel="nofollow external"}」后第一次把项目代码从远程仓库 `pull` 到本地时——「这是什么玩意？！」——我的内心是震惊并诧异的。

为什么我会有如此反应？

「[买好车][mhc-url]{:target="_blank"}{:rel="nofollow external"}」是一家具有阿里基因的公司，创始人和员工很多来自阿里。众所周知，阿里的技术是很不错的，基本每年都会主办一些技术会议，有些技术书籍也是阿里人著作或翻译的。因此，心理上会对他们在技术方面有较高的预期。然而，呈现在眼前的现实将我从幻想中拉了出来……

[mhc-url]: https://www.maihaoche.com

## 团队存在的问题

### 代码维护

不像大部分团队那样前后端代码放在一起维护，我们的项目代码是分开管理、维护的，即前后端代码不在同一个 Git 仓库当中。前端代码只有一个仓库，存放了公用资源、活动页、主站等不同业务线的代码，每个项目是一个目录；后端代码以项目为单位分为几个不同的仓库存放。部署上线也是分开进行。

这种做法美其名曰「前后端分离」，实际到底是不是，值得思考。

### Git 的使用

团队在使用 Git 时主要存在三方面问题：分支管理；提交信息；分支合并。

每次打开 SourceTree，首先映入眼帘的就是五颜六色的「彩虹线」——

![提交记录图表]({{ "posts/20160204/git-graph.png" | asset_path }}){:style="max-width: 284px;"}

和好些过期的分支——

![无用的远程分支]({{ "posts/20160204/git-remote-branches.png" | asset_path }}){:style="max-width: 83px;"}

看得我简直是头晕目眩，不知从何「编」起啊！

造成这种情况的最直接的原因就是，没有一个好的分支管理策略。这里的分支管理策略是这样的：

每周有两个固定的发布日，在每个发布日之前某个管理发布的测试工程师（是的，我们没有运维工程师）会基于 `master` 分支创建前缀为 `pub_` 的发布分支，在发布之前会将要发布的内容都汇总在这个分支上进行测试，通过后再合并到 `master` 分支上进行发布。然而，发布完不会立刻将那个分支删掉，而是要保留几个星期以避免出问题。这样就会像上图中那样有好多过期的分支留在那里。

有些不是立刻发布的内容，后端工程师们就会自己基于 `master` 分支创建出 `dev_` 为前缀的分支来开发新内容。

虽然他们在创建分支时都是有一定的规则，但这种做法产生了一些「垃圾」分支，以及使 `master` 分支看起来不那么稳定，像定时炸弹一样随时会「嘭」！

我觉得团队中应该采用 [Git Flow](http://nvie.com/posts/a-successful-git-branching-model/){:target="_blank"}{:rel="nofollow external"} 来管理分支，这是一个经过多少团队验证的分支模型，我有信心它能够应对我们团队所遇到的各种场景。

我所在的上家公司在 Git 使用方面就非常好，无论是分支管理还是其他一些操作，都很规范，以至于在代码出现问题时很快能够追踪查找到问题所在。

### 前端工程

* 前端 Git 仓库混杂了很多不同的业务；
* 前端源代码用的是 `.css` 和 `.js` 等编写；
* 没有合理使用前端构建工具；
* 静态资源文件的发布流程繁琐；
* 活动页面的编写方式麻烦，并且对搜索引擎不友好。

上述问题中除了第一条是整个技术团队所共有的，其余的皆为前端开发中所存在的问题，即前端团队的问题。我作为一名前端工程师，虽然暂时无法去对整个技术团队做什么，但是可以在前端团队中做些力所能及的事情。在我看来，「有问题」就代表着「机遇」，该是我大展拳脚的时候了！想起来都觉得肾上腺素大量分泌，热血沸腾！

## 解决问题的方案

那么，我该做些什么呢？

我所想到的能够提高前端团队工作效率和生产力的手段有：

1. 制定编码及文件存放等的规范和约定；
2. 选择高效的语言编写源码；
3. 选择合适的自动化工具；
4. 保证以上几条顺利执行的措施。

想要完成这些事情不是一朝一夕的事情，前端工程优化之路任重而道远啊……
