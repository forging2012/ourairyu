<!DOCTYPE html><html lang="zh-CN" dir="ltr"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>前端工程优化之路 - 欧雷流</title><meta name="description" content="不走寻常路"><link rel="author" href="http://ourai.ws/"><link rel="icon" href="/assets/favicon-d770cf1b4a3a03cd5bac1dde4e2e413f.ico"><link rel="stylesheet" href="/assets/global-c017bcef7ea2afa63857411ff4ca6f8e.css"><link rel="stylesheet" href="/assets/pages/common-fc9758f07ee56a73cf7a62bb95734b5f.css"> <script src="/assets/global-6d5e42c77c3a921431d6341f6f4e7f96.js"></script><!--[if lt IE 9]><script src="/assets/support_ie8-f9109bd900850d4f4fbac70091ae986d.js"></script><![endif]--></head><body itemscope itemtype="http://schema.org/WebPage"> <nav class="Page-navs"><ul><li><a href="/">首页</a></li><li><a href="/posts/">文章</a></li><li><a href="/about/">关于</a></li></ul> </nav> <header class="Page-header container sr-only"><div><h1>欧雷流</h1><p>不走寻常路</p></div> </header> <main> <article class="container"> <header><h1>前端工程优化之路</h1><p><time datetime="2016-02-04 16:35:36 +0800">2016-02-04 16:35:36</time>发布</p> </header><div class="Article-content col-md-9"><p>在我加入「<a href="https://www.maihaoche.com" target="_blank" rel="nofollow external">买好车</a>」后第一次把项目代码从远程仓库 <code>pull</code> 到本地时——「这是什么玩意？！」——我的内心是震惊并诧异的。</p><p>为什么我会有如此反应？</p><p>「<a href="https://www.maihaoche.com" target="_blank" rel="nofollow external">买好车</a>」是一家具有阿里基因的公司，创始人和员工很多来自阿里。众所周知，阿里的技术是很不错的，基本每年都会主办一些技术会议，有些技术书籍也是阿里人著作或翻译的。因此，心理上会对他们在技术方面有较高的预期。然而，呈现在眼前的现实将我从幻想中拉了出来……</p><h2 id="section">代码维护</h2><p>不像大部分团队那样前后端代码放在一起维护，我们的项目代码是分开管理、维护的，即前后端代码不在同一个 Git 仓库当中。前端代码只有一个仓库，存放了公用资源、活动页、主站等不同业务线的代码，每个项目是一个目录；后端代码以项目为单位分为几个不同的仓库存放。部署上线也是分开进行。</p><p>这种做法美其名曰「前后端分离」，实际到底是不是，值得思考。</p><h2 id="git-">Git 的使用</h2><p>团队在使用 Git 时主要存在三方面问题：分支管理；提交代码；分支合并。</p><h3 id="section-1">分支管理策略</h3><p>每次打开 SourceTree，首先映入眼帘的就是五颜六色的「彩虹线」——</p><p><img src="/assets/posts/20160204/git-graph-565e38c738a092dfa68e74f5551e2899.png" alt="提交记录图表" style="max-width:284px"/></p><p>和好些过期的分支——</p><div class="highlight"><pre><code class="language-text" data-lang="text">.
└─┬─ origin
  ├─── dev_frontend
  ├─── dev_general
  ├─── dev_inquiry
  ├─── dev_maiche
  ├─── pub_20160111
  ├─── pub_20160112
  ├─── pub_20160113
  ├─── pub_20160114
  ├─── pub_20160128
  ├─── pub_20160202
  └─── ...</code></pre></div><p>看得我简直是头晕目眩，不知从何「编」起啊！</p><p>造成这种情况的最直接的原因就是，没有一个好的分支管理策略。这里的分支管理策略是这样的：</p><p>每周有两个固定的发布日，在每个发布日之前某个管理发布的测试工程师（是的，我们没有运维工程师）会基于 <code>master</code> 分支创建前缀为 <code>pub_</code> 的发布分支，在发布之前会将要发布的内容都汇总在这个分支上进行测试，通过后再合并到 <code>master</code> 分支上进行发布。然而，发布完不会立刻将那个分支删掉，而是要保留几个星期以避免出问题。这样就会像上图中那样有好多过期的分支留在那里。</p><p>有些不是立刻发布的内容，后端工程师们就会自己基于 <code>master</code> 分支创建出 <code>dev_</code> 为前缀的分支来开发新内容。</p><p>虽然他们在创建分支时都是有一定的规则，但这种做法产生了一些「垃圾」分支，以及使 <code>master</code> 分支看起来不那么稳定，像定时炸弹一样随时会「嘭」！</p><p>我觉得团队中应该采用 Git Flow 来管理分支，这是一个不知经过多少团队验证的分支模型，我有信心它能够应对我们团队所遇到的各种场景。</p><h3 id="section-2">代码提交准则</h3><p>在使用 Git 时应该遵守一个基本原则——使提交记录尽可能简洁详细，看它就像读一本书。要达到这种效果，只需牢记几点：</p><ul><li>控制 <code>commit</code> 粒度；</li><li>填好 <code>commit</code> 信息；</li><li>调节 <code>push</code> 频率；</li><li>多 <code>rebase</code> 少 <code>merge</code>。</li></ul><p>要使每个 <code>commit</code> 都具有意义，粒度最好控制为一个小 feature 或者一个 bug fix，这样进行 <code>revert</code> 之类操作时能够将「误伤」减到最低。</p><p>一个好的 <code>commit</code> 信息是，用一句简练的话写在第一行，然后空一行略微详细地阐述该提交所增加或修改的地方：</p><div class="highlight"><pre><code class="language-text" data-lang="text">Redirect user to the requested page after login

https://trello.com/path/to/relevant/card

Users were being redirected to the home page after login, which is less
useful than redirecting to the page they had originally requested before
being redirected to the login form.

* Store requested path in a session variable
* Redirect to the stored location after successfully logging in the user</code></pre></div><p>不要每 <code>commit</code> 一次就 <code>push</code> 一次，多积攒几个 <code>commit</code> 后一次性 <code>push</code>，这样可以避免前一个 <code>commit</code> 后发现代码中还有小错误，这时可以通过 <code>rebase</code> 进行 <code>commit</code> 的合并或者信息修改。</p><p>为了保持图表清晰和代码完整性，要掌握好 <code>commit</code> 和 <code>push</code> 操作的时机——</p><p>还没有 <code>push</code> 到远程仓库时，如无必要则只 <code>commit</code> 不要 <code>push</code>，只在需要与他人配合开发时再 <code>push</code>。当所在分支已经完成职责时，需将父级分支的代码 <code>rebase</code> 到当前分支（得先保证父级分支在本地是最新的），然后合并至父级分支并删除当前分支。理想情况是，<strong>这个分支的整个生命周期没有进行过一次 <code>push</code> 操作</strong>。</p><p>当已经 <code>push</code> 到远程仓库时，先积累几个 <code>commit</code> 的内容而不去做 <code>commit</code> 操作，等到要 <code>push</code> 时先 <code>pull</code> 代码到本地，然后按照上述粒度做几次 <code>commit</code>，再 <code>push</code> 到远程服务器。这种操作流程能够有效避免因代码冲突而造成的 <code>commit</code> 丢失等意想不到的问题，以及减少因 <code>merge</code> 产生的 <code>commit</code> 节点。</p><p><img src="/assets/posts/20160204/git-merge-59f3720b01fc28ce52a021216319b41a.png" alt="合并分支产生的节点" style="max-width:280px"/></p><h3 id="section-3">扩展阅读</h3><ul><li><a href="http://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="nofollow external">A successful Git branching model</a></li><li><a href="https://robots.thoughtbot.com/5-useful-tips-for-a-better-commit-message" target="_blank" rel="nofollow external">5 Useful Tips For A Better Commit Message</a></li><li><a href="http://chris.beams.io/posts/git-commit/" target="_blank" rel="nofollow external">How to Write a Git Commit Message</a></li></ul><h2 id="section-4">前端工程</h2><ul><li>前端 Git 仓库混杂了很多不同的业务；</li><li>前端源代码用的是 <code>.css</code> 和 <code>.js</code> 等编写；</li><li>没有合理使用前端构建工具；</li><li>静态资源文件的发布流程繁琐；</li><li>活动页面的编写方式麻烦，并且对搜索引擎不友好。</li></ul><p>上述问题中除了第一条是整个技术团队所共有的，其余的皆为前端开发中所存在的问题，即前端团队的问题。我作为一名前端工程师，虽然暂时无法去对整个技术团队做什么，但是可以在前端团队中做些力所能及的事情。在我看来，「有问题」就代表着「机遇」，该是我大展拳脚的时候了！想起来都觉得肾上腺素大量分泌，热血沸腾！</p><p>那么，我该做些什么呢？</p><p>我所想到的能够提高前端团队工作效率和生产力的手段有：</p><ol><li>制定编码及文件存放等的规范和约定；</li><li>选择高效的语言编写源码；</li><li>选择合适的自动化工具；</li><li>保证以上几条顺利执行的措施。</li></ol><p>想要完成这些事情不是一朝一夕的事情，前端工程优化之路任重而道远啊……</p></div> <footer class="col-md-3"><div class="Article-meta"><p><a href="/about/" class="Author-link--withAvatar"><img src="/assets/avatars/ourai-100px-c12530e270d0aa48f4bddc067ec66ce0.jpg"></a><a href="/about/" class="Author-link">欧雷</a>发表于<br>Web 开发</p><div id="supportAuthor"><p>如果您觉得文章内容有所帮助，请随意打赏。您的支持将鼓励作者继续创作！</p><ul><li><img src="/assets/qrcodes/pay/alipay/ourai-95f3f9a7ad63ae0b2c12ae8f7da284bb.jpg"></li><li><img src="/assets/qrcodes/pay/wechat/ourai-dbfd38193e96f087bfb12eb18df33f45.jpg"></li></ul></div></div> </footer> </article><div class="container"><div class="row"><div id="disqus_thread" class="col-md-9"></div></div></div> <script>var disqus_shortname="ourairyu";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </main> <script src="/assets/pages/post-62b1caf1332a98300005a4fd9dceb60c.js"></script></body></html>