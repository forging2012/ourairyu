<!DOCTYPE html> <html lang="zh-CN" dir="ltr"> <head> <meta charset="UTF-8"> <!-- SEO --> <title>前端工程优化之路</title> <meta property="og:title" content="前端工程优化之路"> <meta name="description" content="在我加入「买好车」后第一次把项目代码从远程仓库拉取到本地时——「这是什么玩意？！」——我的内心是震惊并诧异的。"> <meta property="og:description" content="在我加入「买好车」后第一次把项目代码从远程仓库拉取到本地时——「这是什么玩意？！」——我的内心是震惊并诧异的。"> <link rel="canonical" href="http://ourai.ws/posts/engineering-problems-of-frontend-development/"> <meta property="og:url" content="http://ourai.ws/posts/engineering-problems-of-frontend-development/"> <meta property="og:site_name" content="欧雷流"> <script type="application/ld+json"> { "@context" : "http://schema.org", "@type" : "WebSite", "name" : "欧雷流", "url" : "http://ourai.ws" } </script> <meta property="og:type" content="article"> <meta property="article:published_time" content="2016-02-04T16:35:36+08:00"> <link rel="prev" href="http://ourai.ws/posts/need-to-learn-investing/" title="嘿！土好吃吗？"> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "NewsArticle", "headline": "前端工程优化之路", "image": null, "datePublished": "2016-02-04T16:35:36+08:00", "description": "在我加入「买好车」后第一次把项目代码从远程仓库拉取到本地时——「这是什么玩意？！」——我的内心是震惊并诧异的。" } </script> <link rel="author" href="http://ourai.ws"> <!-- 页面渲染兼容性 --> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="renderer" content="webkit"> <meta name="viewport" content="width=device-width,initial-scale=1.0"> <!-- 订阅 --> <link type="application/atom+xml" rel="alternate" href="http://ourai.ws/atom.xml" title="欧雷流" /> <link type="application/rss+xml" rel="alternate" href="http://ourai.ws/rss.xml" title="欧雷流"> <!-- 站点 icon --> <link rel="icon" href="/assets/favicon-3e749ca030e3b71eb2662d947c789061d2da9e0f4ee5f3360cfa9ccbe053c8ba.ico"> <!-- 静态资源 --> <link type="text/css" rel="stylesheet" href="/assets/global-f8df8890c111b9e191ac6c5a3e4106a852b891746130c77e5cc3ae7348d7c5d6.css"> <link type="text/css" rel="stylesheet" href="/assets/share-2811f36e337fef8021089414f657904b7e88db17d8ecade0688c8c3f5e632a5c.css"> <link type="text/css" rel="stylesheet" href="/assets/pages/post-91bc00acd467a2ac26d396fbc08fe8c0e00e06371fc8b47557c942a0ff2cb6c8.css"> <script type="text/javascript" src="/assets/global-16a1c80d71f14d30d3623f2857ac2ab2bad5139b4fe6299dfb21f57e61143ecd.js"></script> <!--[if lt IE 9]> <script type="text/javascript" src="/assets/support_ie8-e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.js"></script> <![endif]--> </head> <body class="Page" itemscope itemtype="http://schema.org/WebPage"> <header class="Page-header"> <div class="navbar navbar-static-top"> <div class="container"> <div class="navbar-header"> <button class="navbar-toggle collapsed" type="button" data-target=".Page-navs" data-toggle="collapse"> <span class="sr-only">切换导航</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a href="/" class="navbar-brand">Ourai.WS</a> </div> <!-- 导航 --> <nav class="Page-navs navbar-collapse collapse"> <ul class="nav navbar-nav"> <li><a href="/">首页</a></li> <li><a href="/posts/">文章</a></li> <li><a href="/about/">关于</a></li> </ul> </nav> </div> </div> </header> <main class="Page-content"> <!-- 内容主体 --> <div class="container"> <article class="Page-main Article"> <header class="Article-header"> <h1 class="Article-title">前端工程优化之路</h1> <p><a href="/about/">欧雷</a> 发表于 <time datetime="2016-02-04T16:35:36+08:00">2016-02-04 16:35:36</time></p> <div class="Article-tags"> <span>标签：</span> <ul> <li><a href="/tags/frontend-web-development/">前端开发</a></li> <li><a href="/tags/software-engineering/">软件工程</a></li> <li><a href="/tags/frontend-engineering/">前端工程</a></li> <li><a href="/tags/maihaoche/">买好车</a></li> </ul> </div> </header> <div class="Article-content col-md-9"> <p>在我加入「<a href="https://www.maihaoche.com" target="_blank" rel="nofollow external">买好车</a>」后第一次把项目代码从远程仓库拉取到本地时——「这是什么玩意？！」——我的内心是震惊并诧异的。</p> <p>为什么我会有如此反应？</p> <p>「<a href="https://www.maihaoche.com" target="_blank" rel="nofollow external">买好车</a>」是一家具有阿里基因的公司，创始人和员工很多来自阿里。众所周知，阿里的技术是很不错的，基本每年都会主办一些技术会议，有些技术书籍也是阿里人著作或翻译的。因此，心理上会对他们在技术方面有较高的预期。然而，呈现在眼前的现实将我从幻想中拉了出来……</p> <h2 id="section">代码维护</h2> <p>不像大部分团队那样前后端代码放在一起维护，我们的项目代码是分开管理、维护的，即前后端代码不在同一个 Git 仓库当中。前端代码只有一个仓库，存放了公用资源、活动页、主站等不同业务线的代码，每个项目是一个目录；后端代码以项目为单位分为几个不同的仓库存放。部署上线也是分开进行。</p> <p>这种做法美其名曰「前后端分离」，实际到底是不是，值得思考。</p> <h2 id="git-">Git 的使用</h2> <p>团队在使用 Git 时主要存在两方面问题：分支管理策略和代码提交准则。</p> <h3 id="section-1">分支管理策略</h3> <p>每次打开 SourceTree，首先映入眼帘的就是五颜六色的「彩虹线」——</p> <p><img src="/assets/posts/20160204/git-graph-6eec0b8adf92423dd271d6ba65708099eec0a5c1bcc475bd4ac89e9df2285f96.png" alt="提交记录图表" style="max-width: 284px;" /></p> <p>和好些过期的分支——</p> <figure class="highlight"><pre><code class="language-text" data-lang="text">.
└─┬─ origin
  ├─── dev_frontend
  ├─── dev_general
  ├─── dev_inquiry
  ├─── dev_maiche
  ├─── pub_20160111
  ├─── pub_20160112
  ├─── pub_20160113
  ├─── pub_20160114
  ├─── pub_20160128
  ├─── pub_20160202
  └─── ...</code></pre></figure> <p>看得我简直是头晕目眩，不知从何「编」起啊！</p> <p>造成这种情况的最直接的原因就是，没有一个好的分支管理策略。这里的分支管理策略是这样的：</p> <p>每周有两个固定的发布日，在每个发布日之前某个管理发布的测试工程师（是的，我们没有运维工程师）会基于 <code>master</code> 分支创建前缀为 <code>pub_</code> 的发布分支，在发布之前会将要发布的内容都汇总在这个分支上进行测试，通过后再合并到 <code>master</code> 分支上进行发布。然而，发布完不会立刻将那个分支删掉，而是要保留几个星期以避免出问题。这样就会像上图中那样有好多过期的分支留在那里。</p> <p>有些不是立刻发布的内容，后端工程师们就会自己基于 <code>master</code> 分支创建出 <code>dev_</code> 为前缀的分支来开发新内容。</p> <p>虽然他们在创建分支时都是有一定的规则，但这种做法产生了一些「垃圾」分支，以及使 <code>master</code> 分支看起来不那么稳定，像定时炸弹一样随时会「嘭」！</p> <p>我觉得团队中应该采用 Git Flow 来管理分支，这是一个不知经过多少团队验证的分支模型，我有信心它能够应对我们团队所遇到的各种场景。</p> <h3 id="section-2">代码提交准则</h3> <p>我们团队的 Git 提交记录很「简单」，要么写着几个简单的字母或词语，要么就是合并分支时生成的节点，一眼望去根本不知道那些人到底做了什么。这如果是想查找某个功能点的更改记录，得逐个节点去分析。</p> <p>在使用 Git 时应该遵守一个基本原则——使提交记录尽可能简洁详细，看它就像读一本书。要达到这种效果，只需牢记几点：</p> <ul> <li>控制提交粒度；</li> <li>填好提交信息；</li> <li>调节推送频率；</li> <li>多衍合少合并。</li> </ul> <p>要使每个提交都具有意义，粒度最好控制为一个小 feature 或者一个 bug fix，这样进行恢复等操作时能够将「误伤」减到最低。</p> <p>一个好的提交信息是，用一句简练的话写在第一行，然后空一行略微详细地阐述该提交所增加或修改的地方：</p> <figure class="highlight"><pre><code class="language-text" data-lang="text">Redirect user to the requested page after login

https://trello.com/path/to/relevant/card

Users were being redirected to the home page after login, which is less
useful than redirecting to the page they had originally requested before
being redirected to the login form.

* Store requested path in a session variable
* Redirect to the stored location after successfully logging in the user</code></pre></figure> <p>不要每提交一次就推送一次，多积攒几个提交后一次性推送，这样可以避免前一个提交后发现代码中还有小错误，这时可以通过衍合进行提交的合并或者信息修改。</p> <p>为了保持图表清晰和代码完整性，要掌握好提交和推送操作的时机——</p> <p>还没有推送到远程仓库时，如无必要则只提交不要推送，只在需要与他人配合开发时再推送。当所在分支已经完成职责时，需将父级分支的代码衍合到当前分支（得先保证父级分支在本地是最新的），然后合并至父级分支并删除当前分支。理想情况是，<strong>这个分支的整个生命周期没有进行过一次推送操作</strong>。</p> <p>当已经推送到远程仓库时，先积累几个提交的内容而不去做提交操作，等到要推送时先拉取代码到本地，然后按照上述粒度做几次提交，再推送到远程服务器。这种操作流程能够有效避免因代码冲突而造成的提交丢失等意想不到的问题，以及减少因合并产生的提交节点。</p> <p><img src="/assets/posts/20160204/git-merge-8f2b38826e2d744d52b3d5bccfbf3b5e2e2ac0cbdf0ca6bfd42d6e09c690fbfb.png" alt="合并分支产生的节点" style="max-width: 280px;" /></p> <h3 id="section-3">扩展阅读</h3> <ul> <li><a href="http://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="nofollow external">A successful Git branching model</a></li> <li><a href="https://robots.thoughtbot.com/5-useful-tips-for-a-better-commit-message" target="_blank" rel="nofollow external">5 Useful Tips For A Better Commit Message</a></li> <li><a href="http://chris.beams.io/posts/git-commit/" target="_blank" rel="nofollow external">How to Write a Git Commit Message</a></li> </ul> <h2 id="section-4">前端工程</h2> <p>与整个技术团队相比，前端团队中所存在的问题更多更为严重！基本可以概括为以下几点：</p> <ul> <li>Git 仓库混杂了很多不同的业务；</li> <li>源代码复用性低；</li> <li>没有合理使用构建工具；</li> <li>静态资源文件的发布流程繁琐；</li> <li>活动页面的编写方式麻烦，并且对搜索引擎不友好。</li> </ul> <p>我作为一名前端工程师，虽然暂时无法去对整个技术团队做些什么，但是作为前端团队的一员，却可以在前端团队中做些力所能及的事情。在我看来，「有问题」就代表着「机遇」，该是我大展拳脚的时候了！想起来都觉得肾上腺素大量分泌，热血沸腾！</p> <p>那么，我该做些什么呢？</p> <p>我所想到的能够提高前端团队工作效率和生产力的手段有：</p> <ol> <li>制定编码及文件存放等的规范和约定；</li> <li>选择高效的语言编写源码；</li> <li>选择合适的自动化工具；</li> <li>保证以上几条顺利执行的措施。</li> </ol> <p>为了提高前端团队的整体素质和实力，需要做的事情还有很多。想要完成这些不是一朝一夕的事情，前端工程优化之路任重而道远啊……</p> <p>想在已有的项目上进行改造会存在着很大的阻力，幸好这时公司业务拓展要开发新项目。决定从这新的项目着手，小试牛刀，总结出一套方案后推行整改到其他项目。</p> <p>以本文为引，往后会写几篇关于我们前端团队建设的文章，敬请期待！</p> </div> <footer class="Article-footer col-md-3"> <div class="Widget Article-category"> <div class="Widget-body"> <p>发布在</p> <div> <h3><a href="/categories/web-development/">网站开发</a></h3> <p>利用网页程序语言等技术进行网站和网络应用的开发与维护</p> </div> </div> </div> <div class="Widget Article-license"> <div class="Widget-body"> <p>本文采用知识共享<i class="fa fa-creative-commons"></i><a href="http://creativecommons.org/licenses/by-nc/3.0/cn/" target="_blank">署名-非商业性使用 3.0 中国大陆</a>许可协议，可自由转载、引用，但需署名作者并注明文章出处且不能用于商业用途。</p> </div> </div> <div class="Widget Widget--share"> <div class="Widget-body"> <p>分享到<i class="fa fa-share-alt"></i></p> <div class="social-share" data-sites="wechat,qzone,weibo,twitter"></div> </div> </div> <section class="Widget Widget--toc"> <div class="Widget-header"> <h2 class="Widget-title">目录</h2> </div> <div class="Widget-body"></div> </section> </footer> <div class="Article-comments col-md-9"><div id="disqus_thread"></div> <script type="text/javascript"> /* * * CONFIGURATION VARIABLES * * */ var disqus_shortname = 'ourairyu'; /* * * DON'T EDIT BELOW THIS LINE * * */ (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> </article> </div> </main> <footer class="Page-footer Footer"> <div class="container"> <p class="Footer-copyright">&copy; 2009-2016 <a href="/">欧雷流</a> 版权所有</p> <p class="Footer-support">本站采用 <a href="http://jekyllrb.com" rel="external nofollow" target="_blank">Jekyll</a> 生成并托管于 <a href="https://github.com/ourai/ourai.github.io" rel="external nofollow" target="_blank">GitHub</a> | 主题由<a href="/about/">欧雷</a>设计开发（版本：v4.3.3） <a href="http://validator.w3.org/check?uri=referer" target="_blank" rel="external nofollow" class="fa fa-html5"></a> <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" target="_blank" rel="external nofollow" class="fa fa-css3"></a></p> </div> </footer> <script type="text/javascript" src="/assets/share.min-3155ee636b84a04d036e0f1ba833227d3fd03a4c58a6f2e21c9ceb1c5d0198c7.js"></script><script type="text/javascript" src="/assets/components-7717a5876dfdf1fb3add240a18a3b340cd18af830719f564d25115155f5f7592.js"></script> <script type="text/javascript" src="/assets/initializers/time-8d7a529a66ae6cb53c2283d21fd6a12c538b8473dd5bd76458366d09adce7bf6.js"></script> </body> </html>
