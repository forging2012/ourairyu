<!DOCTYPE html><html lang="zh-CN" dir="ltr"><head><base href="/"><meta charset="UTF-8"><title>网站性能优化·前端篇 - 网道</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="keywords" content="欧雷,欧雷流,宅男的部屋,宅男部屋,宅男,ourai,ourairyu,developer,center,dev,network,front-end,web,网络开发,web开发,开发网络,开发中心"><link rel="author" href="https://plus.google.com/110971881899489153670/"><link rel="shortcut icon" href="images/favicon.ico"><link rel="stylesheet" href="stylesheets/matcha.min.css"><link rel="stylesheet" href="stylesheets/highlight.css"><link rel="stylesheet" href="stylesheets/site.css"><link rel="stylesheet" href="stylesheets/highlight.css"><link rel="stylesheet" href="stylesheets/pages/article.css"> <!--[if lt IE 8]><link rel="stylesheet" href="stylesheets/forbid.css"><![endif]--><!--[if lt IE 9]><script src="javascripts/html5shiv-printshiv.min.js"></script><![endif]--><script src="javascripts/jquery.min.js"></script><script src="javascripts/tatami.min.js"></script><script src="javascripts/matcha.min.js"></script></head><body itemscope itemtype="http://schema.org/WebPage" class="layout--sandwich" data-layout="article" data-page="none"><header class="layout-header"> <nav class="layout-nav layout-inner"><ul><li><a href="/">首页</a></li><li><a href="/projects/">项目</a></li></ul> </nav> </header><main class="layout-container"><div class="layout-content layout-inner"> <article class="article" itemscope itemtype="http://schema.org/Article"> <header class="article-header"><div class="article-title"><h1 itemprop="name">网站性能优化·前端篇</h1></div><div class="article-meta"> <time datetime="2015-03-10" itemprop="datePublished">Mar 10, 2015</time> web performance optimization</div> </header><div class="article-body" itemprop="articleBody"><blockquote><p>我们的目标是优先显示与用户要在网页上执行的主要操作有关的内容。</p></blockquote><p>上面这句话出自《<a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/" target="_blank" rel="external nofollow">关键呈现路径</a>》。</p><h2 class="heading" id="section">什么是前端性能？</h2><p>前端性能简单来说就是<strong>能看到页面内容的时间</strong>以及<strong>可以开始在页面上操作的时间</strong>。</p><p><img src="/images/posts/progressive-rendering.png" alt="Progressive Rendering"/></p><p>前端性能与浏览器的运作方式密切相关，故想要优化性能就要从了解浏览器的工作原理入手。</p><h3 id="section-1">浏览器工作原理</h3><p>基本流程：</p><ol><li>获取 HTML 文档及样式表文件</li><li>解析成对应的树形数据结构（DOM tree &amp; CSSOM tree）</li><li>计算可见节点形成 render tree</li><li>计算形状及位置进行布局</li><li>将每个节点转化为实际像素绘制到视口上（栅格化）</li></ol><p>构建几个树形数据结构：</p><ul><li>DOM tree（开发工具中所显示的 HTML 所定义的内容结构）</li><li>CSSOM tree（样式表所定义的规则结构）</li><li>render tree（页面上所显示的最终结果）</li></ul><p>render tree 是由 DOM tree 与 CSSOM tree 合并并剔除不可见的节点所形成的，其中不包含如下节点：</p><ul><li>本身不可见的<ul><li><code>&lt;html&gt;</code></li><li><code>&lt;head&gt;</code></li><li><code>&lt;meta&gt;</code></li><li><code>&lt;link&gt;</code></li><li><code>&lt;style&gt;</code></li><li><code>&lt;script&gt;</code></li></ul></li><li>设置了 <code>display: none;</code> 样式的</li></ul><p>资源加载</p><ul><li>执行 JavaScript 会阻止 DOM tree 构建</li><li>加载 CSS 会阻止 render tree 构建<ul><li>无论是否为阻止呈现的 CSS，都会被浏览器下载</li></ul></li></ul><p>默认情况下，JavaScript 脚本会在引入它的位置执行（如果是外联脚本则还需要等待加载完毕），这时会阻断 DOM tree 的构建；如果在运行脚本时浏览器尚未完成 CSS 的下载和 CSSOM tree 的构建，浏览器会将脚本执行延迟到这些操作结束之后。</p><p>影响性能的因素：</p><ul><li>白屏<ul><li>HTML 和 CSS 的加载及解析速度</li><li><code>&lt;head&gt;</code> 内的脚本加载及执行</li></ul></li><li>首屏<ul><li>图片加载</li><li><code>&lt;body&gt;</code> 内的脚本加载及执行</li></ul></li><li>render tree 的构建<ul><li>HTML 的复杂度</li><li>CSS 的复杂度</li></ul></li><li>render tree 的绘制（栅格化）<ul><li>颜色的复杂度</li><li>形状的复杂度</li></ul></li></ul><h2 class="heading" id="section-2">怎么提高前端性能？</h2><p>提高以下几个方面，总体性能就会得到大幅度提升：</p><ul><li>缩短白屏时间；</li><li>加快首屏显示；</li><li>尽快监听主要操作的事件。</li></ul><p>所要达到的理想指标：</p><ul><li>60 f/s</li></ul><h3 id="httpsdevelopersgooglecomwebfundamentalsperformancecritical-rendering-pathoptimizing-critical-rendering-pathtargetblankrelexternal-nofollow"><a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/optimizing-critical-rendering-path" target="_blank" rel="external nofollow">优化关键呈现路径</a></h3><p>为了在首次渲染时尽可能快，我们需要优化以下三个变量：</p><ul><li>最小化关键资源数</li><li>最小化关键字节数</li><li>最小化关键路径长度</li></ul><p>常规步骤：</p><ol><li>分析并描述关键路径：资源数、字节数和长度；</li><li>减少关键资源的数量：删掉、延迟下载或标记为异步等等；</li><li>优化剩余关键资源的加载顺序：尽早下载所有关键资源以缩短关键路径长度；</li><li>优化关键字节数以减少下载时间（往返次数）。</li></ol><h3 id="section-3">搜集性能数据</h3><p>通过 <a href="http://www.w3.org/TR/navigation-timing-2/#processing-model" target="_blank" rel="external nofollow">Navigation Timing</a> API 可以获取浏览器在处理网页的关键步骤的时间戳。</p><p><img src="/images/posts/dom-navtiming.png" alt="Part of Navigation Timing Processing Model"/></p><p>其中，各步骤的意义如下：</p><ol><li><strong>domLoading</strong> 表示开始解析第一批收到的 HTML 文档的字节</li><li><strong class="important">domInteractive</strong> 表示完成全部 HTML 的解析并且 DOM 构建完毕</li><li><strong class="important">domContentLoaded</strong> 表示 <a href="http://calendar.perfplanet.com/2012/deciphering-the-critical-rendering-path/" target="_blank" rel="external nofollow">DOM 与 CSSOM 皆已准备就绪</a><ul><li>如果没有解析器阻塞 JavaScript，<em>DOMContentLoaded</em> 事件会在 <em>domInteractive</em> 之后立即触发</li><li>很多 JavaScript 框架会在执行它们自己的逻辑前等待这个事件的触发</li></ul></li><li><strong class="important">domComplete</strong> 表示所有的处理都已完成并且所有的附属资源都已经下载完毕</li><li><strong>loadEvent</strong> 作为网页加载的最后一步以便触发附加的应用逻辑</li></ol><h3 id="pagespeed-httpsdevelopersgooglecomwebfundamentalsperformancecritical-rendering-pathpage-speed-rules-and-recommendationstargetblankrelexternal-nofollow"><a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/page-speed-rules-and-recommendations/" target="_blank" rel="external nofollow">PageSpeed 规则和建议</a></h3><ul><li>排除阻止呈现的 JavaScript 和 CSS</li><li>优化 JavaScript 的用法<ul><li>推荐使用异步 JavaScript 资源</li><li>Avoid synchronous server calls</li><li>延迟解析 JavaScript</li><li>避免运行时间长的 JavaScript</li></ul></li><li>优化 CSS 的用法<ul><li>将 CSS 放到文档头部</li><li>避免使用 CSS import</li><li>内联阻止呈现的 CSS</li></ul></li></ul></div> <footer class="article-footer"><div class="article-switcher"> <span class="prev_article"> </span> <a href="/posts/fetch-url-of-script-file/" class="next_article" title="获取 JavaScript 脚本文件路径">获取 JavaScript 脚本文件路径</a></div><ul class="related_articles"><li><a href="/posts/fetch-url-of-script-file/" title="获取 JavaScript 脚本文件路径">获取 JavaScript 脚本文件路径</a></li><li><a href="/posts/definition-list-with-dl/" title="用 DL 标签实现信息列表">用 DL 标签实现信息列表</a></li><li><a href="/posts/passing-parameters-between-pages-implicitly/" title="页面间隐式传递参数">页面间隐式传递参数</a></li><li><a href="/posts/ie-block-level-element-height-not-zero/" title="IE6、IE7 及 IE8 怪癖模式下空块级非替换元素高度不为 0">IE6、IE7 及 IE8 怪癖模式下空块级非替换元素高度不为 0</a></li><li><a href="/posts/container-margin-collapse/" title="容器与内部元素外边距重叠">容器与内部元素外边距重叠</a></li><li><a href="/posts/php-access-data-messy-code/" title="php 读取数据中文乱码解决方案">php 读取数据中文乱码解决方案</a></li><li><a href="/posts/horizontal-round-corner-menu/" title="圆角横向菜单实现技巧">圆角横向菜单实现技巧</a></li></ul> </footer> </article><div id="disqus_thread"></div> <script>var disqus_shortname="ouraidev";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div> </main> <footer class="layout-footer"><div class="layout-inner"><div class="footer-links"><div class="internal"> <b>内部通道</b><ul><li><a href="/about/">关于本站</a></li><li><a href="/links/">外部链接</a></li></ul></div><div class="other"> <b>狡兔三窟</b><ul><li><a href="http://ourai.ws/" target="_blank" rel="external nofollow">欧雷流</a></li><li><a href="https://github.com/ourai" target="_blank" rel="external nofollow">GitHub</a></li><li><a href="https://www.codewars.com/users/ourai" target="_blank" rel="external nofollow">Codewars</a></li><li><a href="http://segmentfault.com/u/ourai" target="_blank" rel="external nofollow">SegmentFault</a></li><li><a href="http://weibo.com/ourairyu" target="_blank" rel="external nofollow">微博</a></li></ul></div></div><p class="w3c_techs"><a href="http://validator.w3.org/check?uri=referer" target="_blank" rel="external nofollow"><img src="http://www.w3.org/html/logo/badge/html5-badge-h-css3-semantics.png" width="165" height="64" alt="HTML5 Powered with CSS3 / Styling, and Semantics" title="HTML5 Powered with CSS3 / Styling, and Semantics"></a></p><div class="profile" itemscope itemtype="http://schema.org/Person" lang="en"> <a href="http://lin.ourai.ws/" class="avatar_link" target="_blank" rel="external nofollow"><img class="avatar" src="/images/avatars/mask_2d.jpg?s=120" itemprop="image" alt="欧雷"></a><div class="profile_info"><h3 class="author"><a href="http://lin.ourai.ws/" class="author_link" itemprop="name" target="_blank" rel="external nofollow">Ourai Lin</a></h3><p>Developer / Blogger</p></div></div><p class="copyright">Copyright © 2011-2015 <a href="http://ourai.ws/" target="_blank" rel="external nofollow" title="欧雷流">Ourai.WS</a></p><p class="dependencies">Powered by <a href="https://github.com/" target="_blank" rel="external nofollow" title="GitHub is the best place to share code with friends, co-workers, classmates, and complete strangers. Over four million people use GitHub to build amazing things together.">GitHub</a>, <a href="http://jekyllrb.com/" target="_blank" rel="external nofollow" title="Jekyll is a simple, blog-aware, static site generator. It takes a template directory containing raw text files in various formats, runs it through Markdown (or Textile) and Liquid converters, and spits out a complete, ready-to-publish static website suitable for serving with your favorite web server.">Jekyll</a>, <a href="http://disqus.com/" target="_blank" rel="external nofollow" title="Disqus is a free service that enables great online communities. As the web’s most popular discussion system, Disqus is used by millions of websites that cover pretty much any topic imaginable. Its magic is in connecting people to stuff worth talking about.">Disqus</a></p></div> </footer><script>Tatami.sandbox()</script><!--[if lt IE 8]><div class="forbidden_message"><p>很抱歉，本站不支持低于 Internet Explorer 8 的浏览器。</p><p>如果您想继续用 Internet Explorer 浏览器访问本站，请先<a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" target="_blank">升级</a>。</p></div><![endif]--></body></html>